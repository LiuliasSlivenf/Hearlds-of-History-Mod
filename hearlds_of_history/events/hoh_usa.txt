###########################
# USA Events
###########################

add_namespace = hoh_usa

##US demands the southwest, event for Urbanlia
country_event = {
	id = hoh_usa.1
	title = hoh_usa.1.t
	desc = hoh_usa.1.d
	picture = GFX_report_event_canada_patriation

	is_triggered_only = yes
	option = { #Try pacify with military access
		name = hoh_usa.1.a
		ai_chance = {
			factor = 60
			modifier = {
				is_in_faction = no
				not = { has_global_flag = mtg_usa_north_american_dominion_refused_faction }
				factor = 3
			}
			modifier = {
        divisions_in_state = {
          state = 821 
          size > 7 
        }
				factor = 0
			}
			modifier = {
				strength_ratio = {
					tag = USA
					ratio > 1
				}
				factor = 0
			}
			modifier = {
				strength_ratio = {
					tag = USA
					ratio < 1
				}
				factor = 100
			}
		}
		FROM = {
			country_event = hoh_usa.2
		}
	}
	option = { #refuse
		name = hoh_usa.1.b
		ai_chance = {
			factor = 40
		}
		add_war_support = 0.05
		set_country_flag = north_american_dominion_refused
		if = {
			limit = {
				not = { has_global_flag = mtg_usa_north_american_dominion_refused_faction }
				is_in_faction = no
			}
			unlock_decision_tooltip = { decision = USA_form_defensive_alliance_north_american_dominion show_effect_tooltip = yes}
		}
		else_if = {
			limit = {
				is_in_faction = no
			}
			unlock_decision_tooltip = { decision = USA_join_defensive_alliance_north_american_dominion show_effect_tooltip = yes}	
		}
		FROM = {
			country_event = hoh_usa.3
		}

		effect_tooltip = {
			FROM = {
				create_wargoal = {
					type = take_state
					target = ROOT
					generator = { 359 360 821 825 826 }
				}
			}
		}
	}
}

##Urbanlia proposes military access
country_event = {
	id = hoh_usa.2
	title = hoh_usa.2.t
	desc = hoh_usa.2.d
	picture = GFX_report_event_canada_treaty

	is_triggered_only = yes
	option = { #agree
		name = hoh_usa.2.a
		ai_chance = {
			factor = 35
		}
		diplomatic_relation = {
   		country = FROM
   		relation = military_access
   		active = yes
  	}  
    diplomatic_relation = {
      country = FROM
      relation = non_aggression_pact
      active = yes
    }
	}
	option = { #refuse
		name = hoh_usa.2.b
		ai_chance = {
			factor = 65
		}
		FROM = {
			country_event = hoh_usa.4
		}
	}
}

##Urbanlia refuses
country_event = {
	id = hoh_usa.3
	title = hoh_usa.3.t
	desc = hoh_usa.3.d
	picture = GFX_report_event_canadian_artillery

	is_triggered_only = yes
	option = { #war!
		name = mtg_usa_canadian_corridor.3.a
		ai_chance = {
			factor = 90
			modifier = {
				has_war = yes
				factor = 0
			}
		}
		create_wargoal = {
			type = take_state
			target = FROM
			generator = { 359 360 821 825 826 }
		}
	}
	option = { #no war!
		name = mtg_usa_canadian_corridor.3.b
		ai_chance = {
			factor = 10
		}
		add_war_support = -0.1
	}
}

##USA refuses the proposal of Urbanlia
country_event = {
	id = hoh_usa.4
	title = hoh_usa.4.t
	desc = hoh_usa.4.d
	picture = GFX_report_event_soldiers_marching

	is_triggered_only = yes
	option = { #There's no other choice
		name = hoh_usa.4.a
		ai_chance = {
			factor = 90
			modifier = {
				is_in_faction = no
				not = { has_global_flag = mtg_usa_north_american_dominion_refused_faction }
				factor = 3
			}
			modifier = {
				has_war = yes
				factor = 20
			}
		}
		add_war_support = 0.1
		FROM = {
			country_event = hoh_usa.3
		}
		effect_tooltip = {
			FROM = {
        create_wargoal = {
          type = take_state
          target = ROOT
          generator = { 359 360 821 825 826 }
        }
			}
		}
	}
	option = { #transfer states to us
		name = mtg_usa_canadian_corridor.1.a
		ai_chance = {
			factor = 10
			modifier = {
				strength_ratio = {
					tag = USA
					ratio > 1
				}
				factor = 0
			}
		}
		add_stability = -0.1
		add_political_power = -300
		FROM = {
			country_event = hoh_usa.5
		}
		if = {
      limit = { owns_state = 359 }
      FROM = { transfer_state = 359 }
		}
		if = {
      limit = { owns_state = 360 }
      FROM = { transfer_state = 360 }
		}
		if = {
      limit = { owns_state = 821 }
      FROM = { transfer_state = 821 }
		}
		if = {
      limit = { owns_state = 825 }
      FROM = { transfer_state = 825 }
		}
		if = {
      limit = { owns_state = 826 }
      FROM = { transfer_state = 826 }
		}
	}
}

##FROM agrees, message for USA
country_event = {
	id = hoh_usa.5
	title = hoh_usa.5.t
	desc = hoh_usa.5.d
	picture = GFX_report_event_canada_treaty

	is_triggered_only = yes
	option = { #agree
		name = mtg_usa_canadian_corridor.2.a
	}
}

##Demand Chukotka, event for Stellarland
country_event = {
	id = hoh_usa.6
	title = hoh_usa.6.t
	desc = hoh_usa.6.d
	picture = GFX_report_event_canada_patriation

	is_triggered_only = yes
	option = { #Transfer states
		name = mtg_usa_canadian_corridor.1.a
		ai_chance = {
			factor = 5
			modifier = {
        factor = 70
        OR = {
          surrender_progress > 0.55
          AND = {
            OR = {
              has_war_support < 0.25
              has_stability < 0.25
            }
            has_war = yes
          }
        }
			}
			modifier = {
        has_war = no
        divisions_in_state = {
          state = 812 
          size > 2 
        }
				factor = 0
			}
			modifier = {
				strength_ratio = {
					tag = USA
					ratio > 1
				}
				factor = 0
			}
		}
		add_stability = -0.05
		FROM = {
			country_event = hoh_usa.5
			transfer_state = 812
			transfer_state = 831
			transfer_state = 836
		}
	}
	option = { #Offer military access
		name = hoh_usa.1.a
		ai_chance = {
			factor = 20
			modifier = {
        OR = {
          surrender_progress > 0.35
          AND = {
            OR = {
              has_war_support < 0.4
              has_stability < 0.4
            }
            has_war = yes
          }
        }
				factor = 100
			}
			modifier = {
        has_government = FROM
				factor = 100
			}
			modifier = {
        original_tag = CHK
				factor = 100
			}
		}
		add_political_power = 200
		FROM = {
			country_event = hoh_usa.7
		}
	}
	option = { #Refuse
		name = mtg_usa_canadian_corridor.1.b
		ai_chance = {
			factor = 50
			modifier = {
        OR = {
          surrender_progress > 0.35
          AND = {
            OR = {
              has_war_support < 0.4
              has_stability < 0.4
            }
            has_war = yes
          }
        }
				factor = 0
			}
			modifier = {
        has_government = FROM
				factor = 20
			}
		}
		add_war_support = 0.05
		FROM = {
			country_event = hoh_usa.8
		}

		effect_tooltip = {
			FROM = {
				create_wargoal = {
					type = take_state
					target = ROOT
					generator = { 812 831 836 }
				}
			}
		}
	}
}

##Stellarland proposes military access
country_event = {
	id = hoh_usa.7
	title = hoh_usa.2.t
	desc = hoh_usa.7.d
	picture = GFX_report_event_canada_treaty

	is_triggered_only = yes
	option = { #agree
		name = hoh_usa.2.a
		ai_chance = {
			factor = 80
		}
		diplomatic_relation = {
   		country = FROM
   		relation = military_access
   		active = yes
  	}  
    diplomatic_relation = {
      country = FROM
      relation = non_aggression_pact
      active = yes
    }
	}
	option = { #refuse
		name = hoh_usa.2.b
		ai_chance = {
			factor = 20
		}
		FROM = {
			country_event = hoh_usa.9
		}
	}
}

##Stellarland refuses
country_event = {
	id = hoh_usa.8
	title = hoh_usa.3.t
	desc = hoh_usa.8.d
	picture = GFX_report_event_canadian_artillery

	is_triggered_only = yes
	option = { #war!
		name = mtg_usa_canadian_corridor.3.a
		ai_chance = {
			factor = 90
			modifier = {
				has_war = yes
				factor = 0
			}
			modifier = {
				strength_ratio = {
					tag = FROM
					ratio < 1
				}
				factor = 0
			}
			modifier = {
				FROM = { 
          original_tag = STE
          has_completed_focus = STE_military_focus_43
				}
				factor = 0
			}
		}
		create_wargoal = {
			type = take_state
			target = FROM
			generator = { 812 831 836 }
		}
	}
	option = { #no war!
		name = mtg_usa_canadian_corridor.3.b
		ai_chance = {
			factor = 20
		}
		add_war_support = -0.1
	}
}

##USA refuses the proposal of Stellarland
country_event = {
	id = hoh_usa.9
	title = hoh_usa.4.t
	desc = hoh_usa.9.d
	picture = GFX_report_event_soldiers_marching

	is_triggered_only = yes
	option = { #There's no other choice
		name = hoh_usa.4.a
		ai_chance = {
			factor = 90
			modifier = {
				is_in_faction = no
				not = { has_global_flag = mtg_usa_north_american_dominion_refused_faction }
				factor = 3
			}
			modifier = {
				has_war = yes
				factor = 20
			}
		}
		add_war_support = 0.1
		FROM = {
			country_event = hoh_usa.8
		}
		effect_tooltip = {
			FROM = {
        create_wargoal = {
          type = take_state
          target = ROOT
          generator = { 812 831 836 }
        }
			}
		}
	}
	option = { #transfer states to us
		name = mtg_usa_canadian_corridor.1.a
		ai_chance = {
			factor = 10
			modifier = {
				strength_ratio = {
					tag = USA
					ratio > 1
				}
				factor = 0
			}
		}
		add_stability = -0.05
		FROM = {
			country_event = hoh_usa.5
			transfer_state = 812
			transfer_state = 831
			transfer_state = 836
		}
	}
}

# CAN Completed CAN_north_american_alliance, event for USA, URB and MEX (Replace the original event)
country_event = {
	id = hoh_usa.10
	title = tfv_canada.1.t	# Canada asks US to create a faction.
	desc = tfv_canada.1.d	#
	picture = GFX_report_event_canada_patriation
	
	is_triggered_only = yes
	
	option = {
		name = tfv_canada.1.a # Accepts the faction proposal
		
		ai_chance = {
			base = 100
			modifier = {
				has_war_with = FROM
				factor = 0
			}
		}
		
		effect_tooltip = {
			CAN = { create_faction = "north_american_alliance" }
			CAN = { add_to_faction = ROOT }
		}
		hidden_effect = {
			CAN = {
				country_event = { id = hoh_usa.11 }
			}
		}
	}
	
	option = {
		name = tfv_canada.1.b # Rejects the faction proposal
	
		ai_chance = {
			base = 0
			modifier = {
				has_war_with = FROM
				factor = 100
			}
		}
		
		hidden_effect = {
			CAN = {
				country_event = { id = tfv_canada.3 }
			}
		}
	}
}

country_event = {
	id = hoh_usa.11
	title = tfv_canada.2.t	#
	desc = tfv_canada.2.d	#
	picture = GFX_report_event_canadian_soldiers
	
	is_triggered_only = yes
	
	immediate = {
		hidden_effect = {
			save_event_target_as = alliance_inviter
			FROM = {
				save_event_target_as = alliance_applicant
			}
		}
	}

	option = {
		name = tfv_canada.2.a
    if = {
      limit = {
        is_faction_leader = no
        is_in_faction = yes
      }
      leave_faction = yes
			create_faction = "north_american_alliance"
		}
    else_if = {
      limit = {
        is_in_faction = no
      }
			create_faction = "north_american_alliance"
		}
		add_to_faction = FROM
		hidden_effect = {
			set_country_flag = alliance_inviter@ROOT
			FROM = { set_country_flag = alliance_applicant@ROOT }
			news_event = { id = news.289 hours = 12 }
		}
	}
		
}
